{"version":3,"file":"StudentList-0dB5B8zx.js","sources":["../../src/components/StudentList.jsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, useCallback, useRef } from \"react\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { auth, db } from \"../firebase\";\nimport { collection, collectionGroup, doc, documentId, getDoc, getDocs, query, where } from \"firebase/firestore\";\nimport { onAuthStateChanged } from \"firebase/auth\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { \n  faUsers, \n  faFilter, \n  faSearch, \n  faExclamationTriangle, \n  faUserGraduate, \n  faChalkboardTeacher, \n  faClock,\n  faCheckCircle,\n  faEnvelope,\n  faGraduationCap,\n  faIdCard,\n  faArrowRight,\n  faSync,\n  faRocket,\n  faArrowLeft\n} from '@fortawesome/free-solid-svg-icons';\n\n// Ultra-fast cache management\nconst CACHE_KEY = \"studentsCache_v2\";\nconst CACHE_TIMESTAMP_KEY = \"studentsCacheTimestamp\";\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n\nconst StudentList = () => {\n  const [students, setStudents] = useState([]);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [sortOption, setSortOption] = useState(\"name\");\n  const [loading, setLoading] = useState(false); // Start with false for instant display\n  const [error, setError] = useState(null);\n  const [coursesMeta, setCoursesMeta] = useState([]);\n  const [courseFilter, setCourseFilter] = useState(\"\");\n  const [courseIdFilter, setCourseIdFilter] = useState(\"\");\n  const [courseToStudentIds, setCourseToStudentIds] = useState({});\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [loadTime, setLoadTime] = useState(0);\n  \n  const navigate = useNavigate();\n\n  // Performance tracking\n  const startTime = useRef(Date.now());\n  const dataFetched = useRef(false);\n\n  // Instant cache retrieval - runs synchronously\n  const getCachedData = useCallback(() => {\n    try {\n      const cached = localStorage.getItem(CACHE_KEY);\n      const timestamp = localStorage.getItem(CACHE_TIMESTAMP_KEY);\n      \n      if (cached && timestamp) {\n        const age = Date.now() - parseInt(timestamp);\n        if (age < CACHE_DURATION) {\n          const parsed = JSON.parse(cached);\n          if (Array.isArray(parsed) && parsed.length > 0) {\n            return parsed;\n          }\n        }\n      }\n    } catch (error) {\n      console.log(\"Cache read failed:\", error);\n    }\n    return null;\n  }, []);\n\n  // Ultra-optimized data fetching with parallel execution\n  const fetchDataUltraFast = useCallback(async (user) => {\n    if (!user || dataFetched.current) return;\n    \n    dataFetched.current = true;\n    const fetchStart = Date.now();\n    \n    try {\n      // Step 1: Try collectionGroup query first (fastest if index exists)\n      let foundCourses = [];\n      try {\n        const cg = collectionGroup(db, \"courseDetails\");\n        const qy = query(cg, where(\"instructor\", \"==\", user.uid));\n        const snap = await getDocs(qy);\n        \n        foundCourses = snap.docs.map(d => {\n          const seg = d.ref.path.split(\"/\");\n          return {\n            id: d.id,\n            year: seg[1],\n            section: seg[2],\n            semester: seg[3],\n            ...d.data(),\n          };\n        });\n      } catch (error) {\n        // Step 2: Ultra-parallel fallback - all queries at once\n        const years = [\"I\",\"II\",\"III\",\"IV\"];\n        const sections = [\"A\",\"B\",\"C\",\"D\",\"E\",\"F\"];\n        const semesters = [\"sem1\",\"sem2\"];\n        \n        const allQueries = [];\n        for (const y of years) {\n          for (const sec of sections) {\n            for (const sem of semesters) {\n              const col = collection(db, \"courses\", y, sec, sem, \"courseDetails\");\n              const qy = query(col, where(\"instructor\", \"==\", user.uid));\n              allQueries.push(\n                getDocs(qy).then(snap => \n                  snap.docs.map(d => ({ \n                    id: d.id, \n                    year: y, \n                    section: sec, \n                    semester: sem, \n                    ...d.data() \n                  }))\n                ).catch(() => []) // Ignore errors for speed\n              );\n            }\n          }\n        }\n        \n        const results = await Promise.all(allQueries);\n        results.forEach(courses => foundCourses.push(...courses));\n      }\n\n      // Step 3: Extract all student IDs and group by year/section\n      const studentIdGroups = new Map();\n      const courseMeta = [];\n      \n      foundCourses.forEach(course => {\n        courseMeta.push({\n          id: course.id,\n          name: course.courseName,\n          year: course.year,\n          section: course.section,\n          semester: course.semester\n        });\n        \n        (course.students || []).forEach(student => {\n          const sid = typeof student === 'string' ? student : (student?.id || student?.studentId || student);\n          if (sid) {\n            const key = `${course.year}|${course.section}`;\n            if (!studentIdGroups.has(key)) {\n              studentIdGroups.set(key, new Set());\n            }\n            studentIdGroups.get(key).add(sid);\n          }\n        });\n      });\n\n      setCoursesMeta(courseMeta);\n\n      // Step 4: Ultra-parallel student fetching with batching\n      const allStudentQueries = [];\n      const courseToStudentMap = {};\n\n      // Build course to student mapping\n      foundCourses.forEach(course => {\n        courseToStudentMap[course.id] = [];\n        (course.students || []).forEach(student => {\n          const sid = typeof student === 'string' ? student : (student?.id || student?.studentId || student);\n          if (sid) courseToStudentMap[course.id].push(sid);\n        });\n      });\n\n      setCourseToStudentIds(courseToStudentMap);\n\n      // Fetch students in parallel batches\n      for (const [key, idSet] of studentIdGroups.entries()) {\n        const [year, section] = key.split('|');\n        const ids = Array.from(idSet);\n        \n        // Batch in chunks of 10 for optimal performance\n        for (let i = 0; i < ids.length; i += 10) {\n          const chunk = ids.slice(i, i + 10);\n          const col = collection(db, `students/${year}/${section}`);\n          \n          allStudentQueries.push(\n            getDocs(query(col, where(documentId(), 'in', chunk)))\n              .then(snap => snap.docs.map(d => ({ \n                id: d.id, \n                year, \n                section, \n                ...d.data() \n              })))\n              .catch(async () => {\n                // Fallback: individual fetches in parallel\n                const individualQueries = chunk.map(sid => \n                  getDoc(doc(db, `students/${year}/${section}/${sid}`))\n                    .then(snap => snap.exists() ? { id: snap.id, year, section, ...snap.data() } : null)\n                    .catch(() => null)\n                );\n                const results = await Promise.all(individualQueries);\n                return results.filter(Boolean);\n              })\n          );\n        }\n      }\n\n      // Step 5: Execute all queries simultaneously\n      const studentResults = await Promise.all(allStudentQueries);\n      const allStudents = [];\n      studentResults.forEach(students => allStudents.push(...students));\n\n      // Step 6: Remove duplicates and set state\n      const uniqueStudents = allStudents.filter((student, index, self) => \n        index === self.findIndex(s => s.id === student.id)\n      );\n\n      setStudents(uniqueStudents);\n      \n      // Step 7: Cache the results\n      try {\n        localStorage.setItem(CACHE_KEY, JSON.stringify(uniqueStudents));\n        localStorage.setItem(CACHE_TIMESTAMP_KEY, Date.now().toString());\n      } catch (error) {\n        console.log(\"Cache write failed:\", error);\n      }\n\n      const loadTime = Date.now() - fetchStart;\n      setLoadTime(loadTime);\n      console.log(`ðŸš€ Data loaded in ${loadTime}ms`);\n      \n    } catch (error) {\n      console.error(\"Ultra-fast fetch failed:\", error);\n      setError(\"Failed to load students. Please try again.\");\n    } finally {\n      setLoading(false);\n      setIsRefreshing(false);\n    }\n  }, []);\n\n  // Instant display from cache, then background refresh\n  useEffect(() => {\n    const cachedData = getCachedData();\n    if (cachedData) {\n      setStudents(cachedData);\n      setLoading(false);\n      // Start background refresh\n      setIsRefreshing(true);\n    } else {\n      setLoading(true);\n    }\n  }, [getCachedData]);\n\n  // Background data fetching\n  useEffect(() => {\n    let unsubscribe;\n    \n    const initializeData = async () => {\n      unsubscribe = onAuthStateChanged(auth, async (user) => {\n        if (!user) {\n          setError(\"No user is logged in.\");\n          setLoading(false);\n          setIsRefreshing(false);\n          return;\n        }\n\n        // If we have cached data, refresh in background\n        if (students.length > 0) {\n          fetchDataUltraFast(user);\n        } else {\n          // No cache, fetch immediately\n          await fetchDataUltraFast(user);\n        }\n      });\n    };\n\n    initializeData();\n    return () => {\n      if (unsubscribe) unsubscribe();\n    };\n  }, [fetchDataUltraFast, students.length]);\n\n  // Optimized filtering and sorting\n  const filteredStudents = useMemo(() => {\n    let base = students;\n    \n    // Apply course filters\n    if (courseFilter) {\n      const ids = new Set(courseToStudentIds[courseFilter] || []);\n      base = base.filter(s => ids.has(s.id));\n    }\n    \n    if (courseIdFilter.trim()) {\n      const ids = new Set(courseToStudentIds[courseIdFilter.trim()] || []);\n      base = base.filter(s => ids.has(s.id));\n    }\n    \n    // Apply search filter\n    if (searchTerm) {\n      const term = searchTerm.toLowerCase();\n      base = base.filter(student =>\n        (student.name || '').toLowerCase().includes(term) ||\n        (student.email || '').toLowerCase().includes(term) ||\n        (student.rollNo || '').toLowerCase().includes(term)\n      );\n    }\n    \n    // Apply sorting\n    return base.sort((a, b) => {\n      if (sortOption === \"name\") {\n        return (a.name || '').localeCompare(b.name || '');\n      }\n      return 0;\n    });\n  }, [students, searchTerm, sortOption, courseFilter, courseIdFilter, courseToStudentIds]);\n\n  // Force refresh function\n  const handleRefresh = useCallback(async () => {\n    setIsRefreshing(true);\n    dataFetched.current = false;\n    \n    // Clear cache\n    try {\n      localStorage.removeItem(CACHE_KEY);\n      localStorage.removeItem(CACHE_TIMESTAMP_KEY);\n    } catch (error) {\n      console.log(\"Cache clear failed:\", error);\n    }\n    \n    const user = auth.currentUser;\n    if (user) {\n      await fetchDataUltraFast(user);\n    }\n  }, [fetchDataUltraFast]);\n\n  if (loading && students.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 p-8\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"mb-12 animate-fade-in\">\n            <div className=\"h-16 bg-gray-200 rounded-2xl mb-6 animate-pulse\"></div>\n            <div className=\"h-8 bg-gray-200 rounded-xl w-1/3 animate-pulse\"></div>\n          </div>\n          <div className=\"grid gap-8 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3\">\n            {Array.from({ length: 9 }).map((_, i) => (\n              <div key={i} className=\"bg-white rounded-2xl shadow-xl p-8 animate-fade-in border border-gray-100\" style={{ animationDelay: `${i * 50}ms` }}>\n                <div className=\"flex items-center mb-6\">\n                  <div className=\"w-20 h-20 bg-gray-200 rounded-full mr-6 animate-pulse\"></div>\n                  <div className=\"flex-1\">\n                    <div className=\"h-6 bg-gray-200 rounded w-3/4 mb-3 animate-pulse\"></div>\n                    <div className=\"h-4 bg-gray-200 rounded w-1/2 animate-pulse\"></div>\n                  </div>\n                </div>\n                <div className=\"space-y-3 mb-6\">\n                  <div className=\"h-4 bg-gray-200 rounded animate-pulse\"></div>\n                  <div className=\"h-4 bg-gray-200 rounded w-2/3 animate-pulse\"></div>\n                  <div className=\"h-4 bg-gray-200 rounded w-1/2 animate-pulse\"></div>\n                </div>\n                <div className=\"flex gap-3 mb-6\">\n                  <div className=\"h-8 w-20 bg-gray-200 rounded-full animate-pulse\"></div>\n                  <div className=\"h-8 w-24 bg-gray-200 rounded-full animate-pulse\"></div>\n                </div>\n                <div className=\"h-6 w-24 bg-gray-200 rounded animate-pulse\"></div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error && students.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex items-center justify-center p-8\">\n        <div className=\"bg-white rounded-2xl shadow-xl p-12 text-center border border-gray-100\">\n          <FontAwesomeIcon icon={faExclamationTriangle} className=\"text-blue-600 text-6xl mb-6 animate-bounce\" />\n          <div className=\"text-gray-800 text-xl font-semibold mb-6\">{error}</div>\n          <button\n            onClick={handleRefresh}\n            className=\"btn-campus-primary inline-flex items-center gap-3 px-8 py-4 rounded-xl shadow-lg transition-all duration-300 text-lg font-medium\"\n          >\n            <FontAwesomeIcon icon={faSync} />\n            Try Again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"page-container\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <div className=\"flex items-center gap-3\">\n            <h1 className=\"text-2xl font-semibold text-gray-900\">Students</h1>\n            <span className=\"text-xs text-gray-500\">{loadTime > 0 ? `Loaded in ${loadTime}ms` : 'Loading...'}</span>\n            {isRefreshing && (\n              <span className=\"flex items-center gap-1 text-xs text-blue-600\">\n                <FontAwesomeIcon icon={faSync} className=\"animate-spin\" />\n                Refreshing\n              </span>\n            )}\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"text-right\">\n              <div className=\"text-xl font-semibold text-gray-900\">{filteredStudents.length}</div>\n              <div className=\"text-xs text-gray-500\">Total Students</div>\n            </div>\n            <button\n              onClick={handleRefresh}\n              disabled={isRefreshing}\n              className=\"btn-campus-primary inline-flex items-center gap-2 px-4 py-2 rounded-md text-sm disabled:opacity-50\"\n            >\n              <FontAwesomeIcon icon={faSync} className={isRefreshing ? 'animate-spin' : ''} />\n              Refresh\n            </button>\n          </div>\n        </div>\n\n        <div className=\"compact-card mb-6\">\n          <div className=\"grid gap-3 md:grid-cols-4\">\n            <div className=\"md:col-span-2\">\n              <div className=\"relative\">\n                <FontAwesomeIcon icon={faSearch} className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm\" />\n                <input\n                  type=\"text\"\n                  placeholder=\"Search students by name, email, or roll number...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"w-full pl-10 pr-3 py-2 rounded-md border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm bg-gray-50\"\n                />\n              </div>\n            </div>\n            <div>\n              <select\n                value={sortOption}\n                onChange={(e) => setSortOption(e.target.value)}\n                className=\"w-full px-3 py-2 rounded-md border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm bg-gray-50\"\n              >\n                <option value=\"name\">Sort by Name</option>\n                <option value=\"rollNo\">Sort by Roll No</option>\n              </select>\n            </div>\n            <div>\n              <select\n                value={courseFilter}\n                onChange={(e) => setCourseFilter(e.target.value)}\n                className=\"w-full px-3 py-2 rounded-md border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm bg-gray-50\"\n              >\n                <option value=\"\">All Courses</option>\n                {coursesMeta.map((course) => (\n                  <option key={course.id} value={course.id}>\n                    {course.name} ({course.year}-{course.section})\n                  </option>\n                ))}\n              </select>\n            </div>\n          </div>\n        </div>\n\n        <section className=\"grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3\">\n          {filteredStudents.map((student, index) => (\n            <div\n              key={student.id}\n              className=\"group bg-white rounded-lg border p-4 hover:shadow-sm animate-fade-in cursor-pointer transition-all\"\n              style={{ animationDelay: `${index * 50}ms` }}\n              onClick={() => navigate(`/students/${student.year || 'II'}/${student.section || 'A'}/${student.id}`)}\n            >\n              <div className=\"flex items-center mb-4\">\n                <div className=\"w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center mr-3\">\n                  <FontAwesomeIcon icon={faUserGraduate} className=\"text-sm\" />\n                </div>\n                <div className=\"flex-1\">\n                  <h3 className=\"text-sm font-semibold text-gray-900 truncate\">{student.name || 'Unknown'}</h3>\n                  <p className=\"text-xs text-gray-600\">{student.rollNo || 'N/A'}</p>\n                </div>\n                <div className=\"w-2.5 h-2.5 bg-green-500 rounded-full\"></div>\n              </div>\n              \n              <div className=\"space-y-2 mb-4\">\n                <div className=\"flex items-center gap-2 text-xs text-gray-600\">\n                  <FontAwesomeIcon icon={faEnvelope} className=\"text-blue-600 text-sm\" />\n                  <span className=\"truncate\">{student.email || 'No email'}</span>\n                </div>\n                <div className=\"flex items-center gap-2 text-xs text-gray-600\">\n                  <FontAwesomeIcon icon={faIdCard} className=\"text-blue-600 text-sm\" />\n                  <span>{student.rollNo || 'No Roll No'}</span>\n                </div>\n                <div className=\"flex items-center gap-2 text-xs text-gray-600\">\n                  <FontAwesomeIcon icon={faGraduationCap} className=\"text-blue-600 text-sm\" />\n                  <span>{student.year || 'N/A'}-{student.section || 'N/A'}</span>\n                </div>\n              </div>\n\n              <div className=\"flex gap-2 mb-4\">\n                <span className=\"status-active inline-flex items-center px-2 py-1 rounded-full text-xs font-medium\">\n                  <FontAwesomeIcon icon={faCheckCircle} className=\"mr-1\" />\n                  Active\n                </span>\n                <span className=\"status-completed inline-flex items-center px-2 py-1 rounded-full text-xs font-medium\">\n                  {student.year || 'N/A'}-{student.section || 'N/A'}\n                </span>\n              </div>\n\n              <div className=\"flex justify-end\">\n                <button\n                  type=\"button\"\n                  onClick={(e) => { e.stopPropagation(); navigate(`/students/${student.year || 'II'}/${student.section || 'A'}/${student.id}`); }}\n                  className=\"inline-flex items-center gap-1.5 text-blue-600 hover:text-blue-700 font-medium transition-all text-sm\"\n                >\n                  View Details\n                  <FontAwesomeIcon icon={faArrowRight} className=\"transition-transform group-hover:translate-x-1\" />\n                </button>\n              </div>\n            </div>\n          ))}\n        </section>\n\n                      {filteredStudents.length === 0 && !loading && (\n                <div className=\"text-center py-16\">\n                  <div className=\"bg-white rounded-2xl shadow-xl p-12 border border-gray-100\">\n                    <FontAwesomeIcon icon={faUsers} className=\"text-gray-400 text-6xl mb-6\" />\n                    <h3 className=\"text-2xl font-semibold text-gray-700 mb-3\">No students found</h3>\n                    <p className=\"text-gray-600 text-lg\">Try adjusting your search or filter criteria.</p>\n                  </div>\n                </div>\n              )}\n      </div>\n    </div>\n  );\n};\n\nexport default StudentList;\n\n"],"names":["CACHE_KEY","CACHE_TIMESTAMP_KEY","CACHE_DURATION","StudentList","students","setStudents","useState","searchTerm","setSearchTerm","sortOption","setSortOption","loading","setLoading","error","setError","coursesMeta","setCoursesMeta","courseFilter","setCourseFilter","courseIdFilter","setCourseIdFilter","courseToStudentIds","setCourseToStudentIds","isRefreshing","setIsRefreshing","loadTime","setLoadTime","navigate","useNavigate","useRef","dataFetched","getCachedData","useCallback","cached","timestamp","parsed","fetchDataUltraFast","user","fetchStart","foundCourses","cg","collectionGroup","db","qy","query","where","getDocs","d","seg","years","sections","semesters","allQueries","y","sec","sem","col","collection","snap","courses","studentIdGroups","courseMeta","course","student","sid","key","allStudentQueries","courseToStudentMap","idSet","year","section","ids","i","chunk","documentId","individualQueries","getDoc","doc","studentResults","allStudents","uniqueStudents","index","self","s","useEffect","cachedData","unsubscribe","onAuthStateChanged","auth","filteredStudents","useMemo","base","term","a","b","handleRefresh","jsxs","jsx","_","FontAwesomeIcon","faExclamationTriangle","faSync","faSearch","e","faUserGraduate","faEnvelope","faIdCard","faGraduationCap","faCheckCircle","faArrowRight","faUsers"],"mappings":"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"}