import{j as e}from"./query-_HUGc1jU.js";import{g as re,r}from"./router-CGnu6c2M.js";import{d as p,h as A,c as le,q as de,w as ne,b as ie,u as oe}from"./firebase-Cf9C3kP7.js";import{d as h}from"./index-BlT7jYU2.js";import"./vendor-Dazix4UH.js";import"./ui-BFo-ETor.js";const je=()=>{const{year:d,section:n,semester:o,id:c}=re(),[a,$]=r.useState(null),[G,k]=r.useState(!0),[M,j]=r.useState(null),[Q,N]=r.useState(!1),[V,D]=r.useState(""),[x,E]=r.useState([]),[R,z]=r.useState([]),[m,f]=r.useState({name:"",file:null}),[ce,xe]=r.useState({name:"",file:null}),[P,U]=r.useState([]),[i,v]=r.useState("overview"),[u,I]=r.useState({actualHours:"",cls:"",courseCode:"",courseName:"",coveragePercentage:"",deviationReasons:"",instructor:"",ods:"",permissions:"",syllabusCoverage:"",unitsCompleted:""});r.useEffect(()=>{(async()=>{try{k(!0);const t=`courses/${d}/${n}/${o}/courseDetails/${c}`,w=p(h,t),q=await A(w);if(q.exists()){const l={id:c,...q.data()};$(l),I(l),E(l.studyMaterials||[]),z(l.assignments||[]);const Y=p(h,"faculty","CSE_DS","members",l.instructor),F=await A(Y);if(F.exists()?D(F.data().name||"Unknown"):D("Unknown"),Array.isArray(l.students)&&l.students.length>0){const Z=await Promise.all(l.students.map(async g=>{const b=typeof g=="string"?g:g?.id||g?.studentId||g,ee=p(h,`students/${d}/${n}/${b}`),H=await A(ee),se=H.exists()?{id:b,...H.data()}:{id:b};let C=[];try{const L=le(h,"courseDetails"),te=de(L,ne("students","array-contains",b)),ae=await ie(te);C=[],ae.forEach(y=>{const S=y.ref.path.split("/"),O=S[1],T=S[2],_=S[3];O===d&&T===n&&_===o&&y.id===c||C.push({id:y.id,name:y.data().courseName,year:O,section:T,semester:_})})}catch{}return{...se,enrolledCourses:C}}));U(Z)}else U([])}else j("Course not found.")}catch{j("Error fetching course details.")}finally{k(!1)}})()},[c,d,n,o]);const B=s=>{const{name:t,value:w}=s.target;I({...u,[t]:w})},J=async()=>{try{const s=`courses/${d}/${n}/${o}/courseDetails/${c}`,t=p(h,s);await oe(t,{...u,studyMaterials:x,assignments:R}),$({...a,...u,studyMaterials:x,assignments:R}),N(!1)}catch(s){console.error("Error updating course:",s),j("Failed to update course details.")}},K=()=>{m.name.trim()&&(E([...x,m]),f({name:"",file:null}))},W=s=>{f({...m,file:s.target.files[0]})};if(G)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex items-center justify-center p-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center border border-gray-100",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full mx-auto mb-6 animate-pulse"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Loading course details..."})]})});if(M&&!a)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex items-center justify-center p-8",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center border border-gray-100",children:e.jsx("div",{className:"text-blue-600 text-xl font-semibold mb-2",children:M})})});if(!a)return e.jsx("div",{className:"text-center text-gray-600",children:"Course not found or deleted."});const X=Array.isArray(a.students)?a.students.length:0;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("header",{className:"mb-12 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold text-gray-800 mb-3",children:a.courseName}),e.jsxs("p",{className:"text-gray-600 text-lg",children:[a.courseCode," • ",d,"-",n," • ",o?.toUpperCase()]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl px-6 py-4 border border-gray-100 text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Students"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:X})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl px-6 py-4 border border-gray-100 text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Coverage"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.coveragePercentage||"—"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl px-6 py-4 border border-gray-100 text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Units Completed"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.unitsCompleted||"—"})]})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-2 mb-8 border border-gray-100",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"overview",label:"Overview"},{key:"students",label:"Students"},{key:"materials",label:"Materials"},{key:"schedule",label:"Schedule"},{key:"edit",label:"Edit"}].map(s=>e.jsx("button",{onClick:()=>v(s.key),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${i===s.key?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:s.label},s.key))})}),i==="overview"&&e.jsxs("section",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-6",children:"Course Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Instructor"}),e.jsx("div",{className:"text-gray-800 font-medium",children:V})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Class"}),e.jsx("div",{className:"text-gray-800 font-medium",children:a.cls||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Actual Hours"}),e.jsx("div",{className:"text-gray-800 font-medium",children:a.actualHours||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Permissions"}),e.jsx("div",{className:"text-gray-800 font-medium",children:a.permissions||"—"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Syllabus Coverage"}),e.jsx("div",{className:"text-gray-800 font-medium",children:a.syllabusCoverage||"—"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Deviation Reasons"}),e.jsx("div",{className:"text-gray-800",children:a.deviationReasons||"—"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-6",children:"Quick Actions"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{className:"btn-campus-primary px-4 py-3 rounded-xl",children:"Mark Attendance"}),e.jsx("button",{className:"btn-campus-primary px-4 py-3 rounded-xl",children:"Create Assignment"}),e.jsx("button",{onClick:()=>N(!0)||v("edit"),className:"btn-campus-primary px-4 py-3 rounded-xl",children:"Edit Course"})]})]})]}),i==="students"&&e.jsxs("section",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-6",children:"Enrolled Students"}),P.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsx("div",{className:"text-gray-600",children:"No students enrolled."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:P.map(s=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800",children:s.name||s.id}),e.jsx("div",{className:"text-sm text-gray-600",children:s.email||"—"}),e.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:["Roll No: ",s.rollNo||"—"]}),Array.isArray(s.enrolledCourses)&&s.enrolledCourses.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Also enrolled in:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.enrolledCourses.map(t=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-700",children:[t.name||t.id," • ",t.year,"-",t.section," ",t.semester.toUpperCase()]},`${t.year}-${t.section}-${t.semester}-${t.id}`))})]})]},s.id))})]}),i==="materials"&&e.jsxs("section",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-6",children:"Study Materials"}),e.jsxs("ul",{className:"space-y-2",children:[x.length===0&&e.jsx("li",{className:"text-gray-600",children:"No materials added."}),x.map((s,t)=>e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 border border-gray-200 rounded-xl px-4 py-3",children:[e.jsx("span",{className:"text-gray-800",children:s.name}),e.jsx("button",{className:"text-blue-600 hover:underline text-sm",children:"View"})]},t))]}),Q&&e.jsxs("div",{className:"mt-6 grid gap-3 md:grid-cols-3",children:[e.jsx("input",{type:"text",placeholder:"Material Name",value:m.name,onChange:s=>f({...m,name:s.target.value}),className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("input",{type:"file",onChange:W,className:"w-full px-4 py-3 rounded-xl border border-gray-300"}),e.jsx("button",{type:"button",onClick:K,className:"btn-campus-primary rounded-xl px-4 py-3",children:"Add Material"})]})]}),i==="schedule"&&e.jsxs("section",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-6",children:"Schedule"}),e.jsx("div",{className:"text-gray-600",children:"No schedule data available."})]}),i==="edit"&&e.jsxs("section",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-6",children:"Edit Course"}),e.jsxs("form",{className:"grid gap-4 md:grid-cols-2",children:[Object.keys(u).map(s=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600 font-medium",children:s}),e.jsx("input",{type:"text",name:s,value:u[s],onChange:B,className:"px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]},s)),e.jsxs("div",{className:"md:col-span-2 flex gap-3 mt-4",children:[e.jsx("button",{type:"button",className:"btn-campus-primary rounded-xl px-6 py-3",onClick:J,children:"Update"}),e.jsx("button",{type:"button",className:"px-6 py-3 rounded-xl border border-gray-300 hover:bg-gray-100",onClick:()=>N(!1)||v("overview"),children:"Cancel"})]})]})]})]})})};export{je as default};
//# sourceMappingURL=CourseDetails-DhOeO9wl.js.map
