{"version":3,"file":"TakeAttendance-nQ07b4AQ.js","sources":["../../src/components/TakeAttendance.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState, useCallback } from 'react';\nimport { useLocation, useNavigate, useParams } from 'react-router-dom';\nimport { auth, db } from '../firebase';\nimport { collection, collectionGroup, doc, getDoc, getDocs, addDoc, query, where, documentId } from 'firebase/firestore';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faArrowLeft, faClipboardList, faCheckCircle, faClock, faTimesCircle, faUserGraduate, faCalendarAlt, faBookOpen } from '@fortawesome/free-solid-svg-icons';\n\nconst TakeAttendance = () => {\n  const navigate = useNavigate();\n  const { state } = useLocation();\n  const { year, section, semester, courseId } = useParams();\n\n  const [course, setCourse] = useState(state?.course || null);\n  const [students, setStudents] = useState([]);\n  const [attendance, setAttendance] = useState({});\n  const [saving, setSaving] = useState(false);\n  const [selectedDate, setSelectedDate] = useState(() => new Date());\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [facultyCourses, setFacultyCourses] = useState([]);\n  const [coursePreview, setCoursePreview] = useState({}); // { [courseId]: { count, items: [{name, rollNo}] } }\n\n  // Resolve course if not passed via state\n  useEffect(() => {\n    let unsub;\n    const init = async () => {\n      setLoading(true);\n      setError(null);\n      try {\n        await new Promise((resolve) => {\n          unsub = onAuthStateChanged(auth, async (user) => {\n            if (!user) {\n              setError('Not authenticated');\n              setLoading(false);\n              resolve();\n              return;\n            }\n            // If course not present, load from collectionGroup by documentId or list all faculty courses\n            try {\n              if (!course && courseId) {\n                const cg = collectionGroup(db, 'courseDetails');\n                const qs = await getDocs(query(cg, where(documentId(), 'in', [courseId])));\n                qs.forEach((d) => {\n                  const seg = d.ref.path.split('/');\n                  setCourse({ id: d.id, year: seg[1], section: seg[2], semester: seg[3], ...d.data() });\n                });\n              }\n              if (!course && !courseId) {\n                let list = [];\n                try {\n                  const cg = collectionGroup(db, 'courseDetails');\n                  const qs = await getDocs(query(cg, where('instructor', '==', user.uid)));\n                  list = qs.docs.map(d => {\n                    const seg = d.ref.path.split('/');\n                    return { id: d.id, year: seg[1], section: seg[2], semester: seg[3], ...d.data() };\n                  });\n                } catch (_) {\n                  // Fallback without index: enumerate common year/section/semester\n                  const years = ['I','II','III','IV'];\n                  const sections = ['A','B','C','D','E','F'];\n                  const semesters = ['sem1','sem2'];\n                  const tasks = [];\n                  years.forEach((y) => {\n                    sections.forEach((sec) => {\n                      semesters.forEach((sem) => {\n                        tasks.push(getDocs(query(collection(db, 'courses', y, sec, sem, 'courseDetails'), where('instructor', '==', user.uid))));\n                      });\n                    });\n                  });\n                  const results = await Promise.all(tasks);\n                  results.forEach(snap => {\n                    snap.forEach(d => {\n                      const seg = d.ref.path.split('/');\n                      list.push({ id: d.id, year: seg[1], section: seg[2], semester: seg[3], ...d.data() });\n                    });\n                  });\n                }\n                setFacultyCourses(list);\n              }\n            } catch (e) {\n              // non-fatal; user can navigate back\n            }\n            setLoading(false);\n            resolve();\n          });\n        });\n      } catch (e) {\n        setError('Failed to initialize');\n        setLoading(false);\n      }\n    };\n    init();\n    return () => unsub && unsub();\n  }, [course, courseId]);\n\n  // Build course previews (limited student list) when we have facultyCourses\n  useEffect(() => {\n    const buildPreview = async () => {\n      if (!facultyCourses || facultyCourses.length === 0) return;\n      const preview = {};\n      for (const c of facultyCourses) {\n        const ids = Array.isArray(c.students) ? c.students : [];\n        const items = [];\n        let count = ids.length;\n        for (let i = 0; i < Math.min(ids.length, 5); i++) {\n          const sid = ids[i];\n          const tries = [\n            doc(db, `students/${c.year}/${c.section}/${sid}`),\n            doc(db, `students/${sid}`),\n          ];\n          let snap = null;\n          for (const p of tries) {\n            const s = await getDoc(p);\n            if (s.exists()) { snap = s; break; }\n          }\n          if (snap && snap.exists()) {\n            const data = snap.data();\n            items.push({ name: data.name || sid, rollNo: data.rollNo || '' });\n          }\n        }\n        preview[c.id] = { count, items };\n      }\n      setCoursePreview(preview);\n    };\n    buildPreview();\n  }, [facultyCourses]);\n\n  // Load students\n  useEffect(() => {\n    const loadStudents = async () => {\n      if (!course) return;\n      setLoading(true);\n      try {\n        let ids = Array.isArray(course.students) ? course.students : [];\n        if (ids.length === 0) {\n          ids = [];\n        }\n        const list = [];\n        if (ids.length > 0) {\n          for (const sid of ids) {\n            const tries = [\n              doc(db, `students/${course.year}/${course.section}/${sid}`),\n              doc(db, `students/${sid}`),\n            ];\n            let snap = null;\n            for (const p of tries) {\n              const s = await getDoc(p);\n              if (s.exists()) { snap = s; break; }\n            }\n            if (snap && snap.exists()) list.push({ id: snap.id, ...snap.data(), year: course.year, section: course.section });\n          }\n        }\n        setStudents(list);\n        const init = {};\n        list.forEach(s => {\n          init[s.id] = { present: false, late: false, excused: false, absent: true, note: '' };\n        });\n        setAttendance(init);\n      } catch (e) {\n        setError('Failed to load students');\n      } finally {\n        setLoading(false);\n      }\n    };\n    loadStudents();\n  }, [course]);\n\n  const mark = (id, status) => {\n    setAttendance(prev => ({\n      ...prev,\n      [id]: {\n        ...prev[id],\n        present: status === 'present',\n        late: status === 'late',\n        excused: status === 'excused',\n        absent: status === 'absent'\n      }\n    }));\n  };\n\n  const bulk = (status) => {\n    setAttendance(prev => {\n      const next = { ...prev };\n      Object.keys(next).forEach(id => {\n        next[id] = { ...next[id], present: status === 'present', late: status === 'late', excused: status === 'excused', absent: status === 'absent' };\n      });\n      return next;\n    });\n  };\n\n  const totals = useMemo(() => {\n    const vals = Object.values(attendance);\n    const present = vals.filter(v => v.present).length;\n    const late = vals.filter(v => v.late).length;\n    const excused = vals.filter(v => v.excused).length;\n    const absent = vals.filter(v => v.absent).length;\n    return { total: students.length, present, late, excused, absent };\n  }, [attendance, students.length]);\n\n  const save = useCallback(async () => {\n    if (!course) return;\n    setSaving(true);\n    try {\n      await addDoc(collection(db, 'attendance'), {\n        courseId: course.id,\n        courseName: course.courseName || course.id,\n        date: selectedDate.toISOString(),\n        facultyId: auth.currentUser?.uid || '',\n        attendance,\n        totalStudents: totals.total,\n        presentCount: totals.present,\n        lateCount: totals.late,\n        excusedCount: totals.excused,\n        absentCount: totals.absent,\n        createdAt: new Date().toISOString(),\n      });\n      navigate(-1);\n    } catch (e) {\n      setError('Failed to save attendance');\n    } finally {\n      setSaving(false);\n    }\n  }, [course, selectedDate, attendance, totals, navigate]);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-100 dark:bg-gray-900 p-8\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"mb-12 animate-fade-in\">\n            <div className=\"h-16 bg-gray-200 dark:bg-gray-700 rounded-2xl mb-6 animate-pulse\"></div>\n            <div className=\"h-8 bg-gray-200 dark:bg-gray-700 rounded-xl w-1/3 animate-pulse\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center p-8\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-12 text-center border border-gray-200 dark:border-gray-700\">\n          <div className=\"text-gray-950 dark:text-white text-xl font-semibold\">{error}</div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 dark:bg-gray-900 p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        \n        {/* Take Attendance Header Card */}\n        <div className=\"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-6 shadow-lg mb-8\">\n          <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between\">\n            <div className=\"mb-4 lg:mb-0\">\n              <h1 className=\"text-3xl lg:text-4xl font-bold text-gray-950 dark:text-white flex items-center gap-3 mb-2\">\n                <div className=\"w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-xl flex items-center justify-center shadow-lg\">\n                  <FontAwesomeIcon icon={faClipboardList} className=\"text-white text-lg\"/>\n                </div>\n                Take Attendance\n              </h1>\n              <p className=\"text-gray-800 dark:text-gray-200 text-base flex items-center gap-2\">\n                <FontAwesomeIcon icon={faCalendarAlt} className=\"text-gray-800 dark:text-gray-200\"/>\n                {course ? `${course?.courseName || courseId} • ${course?.year}-${course?.section} • ${course?.semester?.toUpperCase?.() || course?.semester}` : 'Select a course to begin'}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {!course && (\n          facultyCourses.length === 0 ? (\n            <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-12 text-center border border-gray-200 dark:border-gray-700\">\n              <FontAwesomeIcon icon={faBookOpen} className=\"text-blue-600 dark:text-blue-400 text-4xl mb-4\" />\n              <h3 className=\"text-xl font-semibold text-gray-950 dark:text-white mb-2\">No courses found</h3>\n              <p className=\"text-gray-800 dark:text-gray-200\">No courses found for your account.</p>\n            </div>\n          ) : (\n            <section className=\"grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3\">\n              {facultyCourses.map((c, i) => (\n                <div key={c.id} className=\"group bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-6 shadow-lg hover:shadow-xl transition-all duration-300 animate-fade-in hover:-translate-y-1\" style={{ animationDelay: `${i * 100}ms` }}>\n                  <div className=\"flex items-start justify-between mb-4\">\n                    <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300\">\n                      <FontAwesomeIcon icon={faBookOpen} className=\"text-lg\" />\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <h3 className=\"text-lg font-bold text-gray-950 dark:text-white mb-3 group-hover:text-secondary transition-colors\">{c.courseName || c.id}</h3>\n                    <p className=\"text-gray-800 dark:text-gray-200 mb-4 text-sm leading-relaxed\">{c.year}-{c.section} • {c.semester?.toUpperCase?.() || c.semester}</p>\n                  </div>\n                  \n                  <div className=\"space-y-3 mb-4\">\n                    <div className=\"flex items-center gap-2 text-sm text-gray-800 dark:text-gray-200\">\n                      <FontAwesomeIcon icon={faUserGraduate} className=\"text-primary\"/>\n                      <span>Enrolled Students: {coursePreview[c.id]?.count ?? 0}</span>\n                    </div>\n                    {coursePreview[c.id]?.items?.length > 0 && (\n                      <div className=\"space-y-1\">\n                        {coursePreview[c.id].items.map((it, idx) => (\n                          <div key={idx} className=\"text-xs text-gray-800 dark:text-gray-200 bg-gray-50 dark:bg-gray-700 rounded-lg px-3 py-2\">\n                            • {it.name}{it.rollNo ? ` (${it.rollNo})` : ''}\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                  \n                  <button onClick={() => setCourse(c)} className=\"bg-primary hover:bg-secondary text-white font-semibold px-4 py-2 rounded-xl text-sm transition-all duration-300 hover:shadow-md\">Start</button>\n                </div>\n              ))}\n            </section>\n          )\n        )}\n\n        {course && (\n          <section className=\"bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 p-6 shadow-lg\">\n            <div className=\"flex flex-wrap items-center gap-3 mb-6\">\n              <span className=\"text-sm text-gray-800 dark:text-gray-200\">Mark all as:</span>\n              <button onClick={() => bulk('present')} className=\"px-4 py-2 rounded-xl bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 text-sm font-medium hover:bg-green-200 dark:hover:bg-green-900/50 border border-green-200 dark:border-green-700 transition-all duration-300\">\n                <FontAwesomeIcon icon={faCheckCircle} className=\"mr-2\"/>Present\n              </button>\n              <button onClick={() => bulk('late')} className=\"px-4 py-2 rounded-xl bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-300 text-sm font-medium hover:bg-orange-200 dark:hover:bg-orange-900/50 border border-orange-200 dark:border-orange-700 transition-all duration-300\">\n                <FontAwesomeIcon icon={faClock} className=\"mr-2\"/>Late\n              </button>\n              <button onClick={() => bulk('excused')} className=\"px-4 py-2 rounded-xl bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 text-sm font-medium hover:bg-blue-200 dark:hover:bg-blue-900/50 border border-blue-200 dark:border-blue-700 transition-all duration-300\">\n                Excused\n              </button>\n              <button onClick={() => bulk('absent')} className=\"px-4 py-2 rounded-xl bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 text-sm font-medium hover:bg-red-200 dark:hover:bg-red-900/50 border border-red-200 dark:border-red-700 transition-all duration-300\">\n                <FontAwesomeIcon icon={faTimesCircle} className=\"mr-2\"/>Absent\n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-1 gap-4\">\n              {students.map((s) => (\n                <div key={s.id} className=\"bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-300\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center\">\n                        <FontAwesomeIcon icon={faUserGraduate} className=\"text-white text-sm\" />\n                      </div>\n                      <div>\n                        <div className=\"text-sm font-bold text-gray-950 dark:text-white\">{s.name || s.id}</div>\n                        <div className=\"text-xs text-gray-800 dark:text-gray-200\">{s.rollNo || s.email}</div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <button onClick={() => mark(s.id, 'present')} className={`px-4 py-2 rounded-xl text-sm font-medium transition-all duration-300 ${\n                        attendance[s.id]?.present \n                          ? 'bg-green-600 text-white shadow-lg' \n                          : 'bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-gray-200 hover:bg-green-100 dark:hover:bg-green-900/30 border border-gray-200 dark:border-gray-600'\n                      }`}>\n                        <FontAwesomeIcon icon={faCheckCircle} className=\"mr-2\"/>Present\n                      </button>\n                      <button onClick={() => mark(s.id, 'late')} className={`px-4 py-2 rounded-xl text-sm font-medium transition-all duration-300 ${\n                        attendance[s.id]?.late \n                          ? 'bg-orange-600 text-white shadow-lg' \n                          : 'bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-gray-200 hover:bg-orange-100 dark:hover:bg-orange-900/30 border border-gray-200 dark:border-gray-600'\n                      }`}>\n                        <FontAwesomeIcon icon={faClock} className=\"mr-2\"/>Late\n                      </button>\n                      <button onClick={() => mark(s.id, 'excused')} className={`px-4 py-2 rounded-xl text-sm font-medium transition-all duration-300 ${\n                        attendance[s.id]?.excused \n                          ? 'bg-blue-600 text-white shadow-lg' \n                          : 'bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-gray-200 hover:bg-blue-100 dark:hover:bg-blue-900/30 border border-gray-200 dark:border-gray-600'\n                      }`}>\n                        Excused\n                      </button>\n                      <button onClick={() => mark(s.id, 'absent')} className={`px-4 py-2 rounded-xl text-sm font-medium transition-all duration-300 ${\n                        attendance[s.id]?.absent \n                          ? 'bg-red-600 text-white shadow-lg' \n                          : 'bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-gray-200 hover:bg-red-100 dark:hover:bg-red-900/30 border border-gray-200 dark:border-gray-600'\n                      }`}>\n                        <FontAwesomeIcon icon={faTimesCircle} className=\"mr-2\"/>Absent\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            <div className=\"mt-6 flex justify-end\">\n              <button onClick={save} disabled={saving} className=\"bg-primary hover:bg-secondary text-white font-semibold px-6 py-3 rounded-xl text-sm transition-all duration-300 hover:shadow-md disabled:opacity-50\">\n                {saving ? 'Saving...' : 'Save Attendance'}\n              </button>\n            </div>\n          </section>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default TakeAttendance;\n"],"names":["TakeAttendance","navigate","useNavigate","state","useLocation","year","section","semester","courseId","useParams","course","setCourse","useState","students","setStudents","attendance","setAttendance","saving","setSaving","selectedDate","setSelectedDate","loading","setLoading","error","setError","facultyCourses","setFacultyCourses","coursePreview","setCoursePreview","useEffect","unsub","resolve","onAuthStateChanged","auth","user","cg","collectionGroup","db","getDocs","query","where","documentId","d","seg","list","years","sections","semesters","tasks","y","sec","sem","collection","snap","preview","c","ids","items","count","i","sid","tries","doc","p","s","getDoc","data","init","mark","id","status","prev","bulk","next","totals","useMemo","vals","present","v","late","excused","absent","save","useCallback","addDoc","jsx","jsxs","FontAwesomeIcon","faClipboardList","faCalendarAlt","faBookOpen","faUserGraduate","it","idx","faCheckCircle","faClock","faTimesCircle"],"mappings":"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"}