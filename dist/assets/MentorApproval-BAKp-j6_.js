import{j as e}from"./query-_HUGc1jU.js";import{r as m}from"./router-CGnu6c2M.js";import{h,j as I,u as Y}from"./firebase-BUGgE2xq.js";import{u as _,d as b}from"./index-DokKvUxf.js";import"./vendor-Dazix4UH.js";import"./ui-CbbphKl4.js";const H=()=>{const{user:$}=_(),[S,y]=m.useState([]),[k,g]=m.useState(!1),[r,C]=m.useState(""),[n,M]=m.useState(""),[c,R]=m.useState(""),d=$?.uid,E=[{label:"I",value:"I"},{label:"II",value:"II"},{label:"III",value:"III"},{label:"IV",value:"IV"}],P=["A","B","C","D","E","F"],U=[{label:"Semester 1",value:"sem1"},{label:"Semester 2",value:"sem2"}];m.useEffect(()=>{d?console.log("Logged in Mentor ID:",d):console.error("No logged-in Mentor ID found!")},[d]);const N=async(s,i)=>{const o=s==="faculty"?h(b,"faculty","CSE_DS","members",i):h(b,s,i),t=await I(o);return t.exists()&&t.data().name||"Unknown"},D=m.useCallback(async()=>{if(!d||!r||!n||!c){console.error("Mentor ID, year, section, or semester is required.");return}g(!0);try{const s=`noDues/${r}/${n}/${c}`,i=h(b,s),o=await I(i);if(!o.exists()){console.error("No noDues document found."),y([]),g(!1);return}const t=o.data();if(console.log("Fetched NoDues Data:",t),!t.students||t.students.length===0){console.log("No students found."),y([]),g(!1);return}const u=await Promise.all(t.students.map(async a=>{try{const f=a?.mentors||[],p=f.find(x=>x?.id===d);if(p){const x=h(b,`students/${r}/${n}`,a.id),j=await I(x),w=p.id?await N("faculty",p.id):"Unknown";if(j.exists()){const v=j.data(),B=Array.isArray(a.coordinators)?await Promise.all(a.coordinators.map(async l=>({...l,name:l?.id?await N("faculty",l.id):"Unknown"}))):[],L=Array.isArray(a.courses_faculty)?await Promise.all(a.courses_faculty.map(async l=>({...l,courseName:l?.courseId?await N(`courses/${r}/${n}/${c}/courseDetails`,l.courseId):"Unknown",facultyName:l?.facultyId?await N("faculty",l.facultyId):"Unknown"}))):[];return{rollNo:v?.rollNo||"N/A",studentName:v?.name||"N/A",mentorName:w,status:p?.status||"Pending",studentId:a.id,mentorIndex:f.indexOf(p),coordinators:B,coursesFaculty:L}}else console.warn(`Student document not found for ID: ${a.id}`)}}catch(f){console.error(`Error processing student ${a.id}:`,f)}return null}));y(u.filter(Boolean))}catch(s){console.error("Error fetching NoDues data:",s),y([])}finally{g(!1)}},[d,r,n,c]),A=async(s,i,o)=>{try{const t=`noDues/${r}/${n}/${c}`,u=h(b,t),a=await I(u);if(!a.exists()){console.error("No noDues document found for updating.");return}const p=a.data().students.map(x=>{if(x.id===s){const j=x.mentors.map((w,v)=>v===i?{...w,status:o}:w);return{...x,mentors:j}}return x});await Y(u,{students:p}),console.log("Mentor status updated successfully!"),D()}catch(t){console.error("Error updating mentor status:",t)}};return m.useEffect(()=>{d&&r&&n&&c&&D()},[d,r,n,c,D]),e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Mentor Approval"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full max-w-4xl mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Year:"}),e.jsxs("select",{value:r,onChange:s=>C(s.target.value),className:"w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Year"}),E.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Section:"}),e.jsxs("select",{value:n,onChange:s=>M(s.target.value),className:"w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Section"}),P.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"Semester:"}),e.jsxs("select",{value:c,onChange:s=>R(s.target.value),className:"w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Semester"}),U.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})]}),k?e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx("div",{className:"loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"}),e.jsx("p",{className:"ml-4 text-blue-600 font-medium",children:"Loading..."})]}):e.jsx("div",{className:"overflow-x-auto w-full max-w-4xl",children:e.jsxs("table",{className:"table-auto w-full border-collapse border border-gray-300 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-2 py-2 border text-left font-semibold",children:"Roll No"}),e.jsx("th",{className:"px-2 py-2 border text-left font-semibold",children:"Student Name"}),e.jsx("th",{className:"px-2 py-2 border text-left font-semibold",children:"Mentor"}),e.jsx("th",{className:"px-2 py-2 border text-left font-semibold",children:"Status"}),e.jsx("th",{className:"px-2 py-2 border text-left font-semibold",children:"Coordinators"}),e.jsx("th",{className:"px-2 py-2 border text-left font-semibold",children:"Courses Faculty"}),e.jsx("th",{className:"px-2 py-2 border text-left font-semibold",children:"Actions"})]})}),e.jsx("tbody",{children:S.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-2 text-center text-gray-500",children:"No data available"})}):S.map((s,i)=>{const o=s.coordinators.every(t=>t.status==="Accepted")&&s.coursesFaculty.every(t=>t.status==="Accepted");return e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-2 py-2 border",children:s.rollNo}),e.jsx("td",{className:"px-2 py-2 border",children:s.studentName}),e.jsx("td",{className:"px-2 py-2 border",children:s.mentorName}),e.jsx("td",{className:"px-2 py-2 border",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs text-white ${s.status==="Accepted"?"bg-green-500":s.status==="Rejected"?"bg-red-500":"bg-yellow-500"}`,children:s.status})}),e.jsx("td",{className:"px-2 py-2 border",children:s.coordinators?.length>0?s.coordinators.map((t,u)=>e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-[11px] font-medium text-white ${t.status==="Accepted"?"bg-green-500":t.status==="Rejected"?"bg-red-500":"bg-yellow-500"} mr-1`,children:t.name},u)):e.jsx("span",{className:"text-gray-500",children:"No Coordinators"})}),e.jsx("td",{className:"px-2 py-2 border",children:s.coursesFaculty?.length>0?s.coursesFaculty.map((t,u)=>e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-[11px] font-medium text-white ${t.status==="Accepted"?"bg-green-500":t.status==="Rejected"?"bg-red-500":"bg-yellow-500"} mr-1`,children:t.facultyName},u)):e.jsx("span",{className:"text-gray-500",children:"No Courses"})}),e.jsxs("td",{className:"px-2 py-2 border",children:[e.jsx("button",{className:`bg-green-600 text-white px-3 py-1 rounded-md mr-2 text-sm ${o?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>A(s.studentId,s.mentorIndex,"Accepted"),disabled:!o,children:"Accept"}),e.jsx("button",{className:`bg-red-600 text-white px-3 py-1 rounded-md text-sm ${o?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>A(s.studentId,s.mentorIndex,"Rejected"),disabled:!o,children:"Reject"})]})]},i)})})]})})]})};export{H as default};
//# sourceMappingURL=MentorApproval-BAKp-j6_.js.map
