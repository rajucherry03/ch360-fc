import{j as e}from"./query-_HUGc1jU.js";import{r as o}from"./router-CGnu6c2M.js";import{m as $,q as L,n as q,I as F,l as B,h as k,j as Q,u as H}from"./firebase-CGo28arV.js";import{u as J,d as b}from"./index-DAak1JJl.js";import"./vendor-Dazix4UH.js";import"./ui-BE1NG-gw.js";const te=()=>{const{user:Y}=J(),[a,P]=o.useState(""),[n,O]=o.useState(""),[j,T]=o.useState("sem1"),[I,f]=o.useState([]),[U,g]=o.useState(!1),[u,S]=o.useState([]),[R,V]=o.useState(""),c=Y?.uid;o.useEffect(()=>{c?console.log("Logged in Faculty ID:",c):console.error("No logged-in Faculty ID found!")},[c]);const D=o.useCallback(async()=>{if(!a||!n||!c){console.error("Year, Section, and Faculty ID are required.");return}g(!0);try{const t=$(b,`noDues/${a}/${n}`),s=L(t,q("generatedAt","desc"),F(1)),r=await B(s);if(r.empty){console.error("No data found for the specified year and section."),f([]),g(!1);return}const x=r.docs[0].data();if(!x.students||x.students.length===0){console.log("No students found in this section."),f([]),g(!1);return}const N=(await Promise.all(x.students.map(async d=>{if(d.coordinators){const l=d.coordinators.find(h=>h.id===c);if(l){const h=k(b,"faculty","CSE_DS","members",l.id),i=await Q(h),v=k(b,`students/${a}/${n}`,d.id),p=await Q(v);if(i.exists()&&p.exists()){const w=i.data(),E=p.data();return{rollNo:E.rollNo||"N/A",studentName:E.name||"N/A",coordinatorName:w.name||"Unknown",status:l.status||"Pending",studentId:d.id,coordinatorIndex:d.coordinators.indexOf(l)}}}}return null}))).filter(Boolean).sort((d,l)=>d.rollNo.localeCompare(l.rollNo));f(N)}catch(t){console.error("Error fetching data:",t),f([])}finally{g(!1)}},[a,n,c]),_=async(t,s,r)=>{try{const m=$(b,`noDues/${a}/${n}`),x=L(m,q("generatedAt","desc"),F(1)),C=await B(x);if(!C.empty){const N=C.docs[0],d=k(b,`noDues/${a}/${n}`,N.id),h=N.data().students.map(i=>{if(i.id===t){const v=i.coordinators.map((p,w)=>w===s?{...p,status:r}:p);return{...i,coordinators:v}}return i});await H(d,{students:h}),console.log("Status updated successfully!"),D()}}catch(m){console.error("Error updating status:",m)}},z=t=>{S(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},A=async t=>{if(u.length>0){for(const s of u){const r=I.find(m=>m.studentId===s);r&&await _(r.studentId,r.coordinatorIndex,t)}S([])}},G=t=>{V(t.target.value)},y=I.filter(t=>{const s=R.toLowerCase();return t.rollNo.toLowerCase().includes(s)||t.studentName.toLowerCase().includes(s)});return o.useEffect(()=>{a&&n&&j&&c&&D()},[a,n,j,c,D]),e.jsxs("div",{className:"min-h-screen bg-background p-6 flex flex-col items-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-primary mb-4",children:"Coordinator Dashboard"}),e.jsxs("div",{className:"w-full max-w-4xl bg-surface border border-border-theme rounded-md p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-secondary font-medium mb-2",children:"Year:"}),e.jsxs("select",{value:a,onChange:t=>P(t.target.value),className:"w-full px-4 py-2 border border-border-theme rounded-md bg-background text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:[e.jsx("option",{value:"",children:"Select Year"}),["I","II","III","IV"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-secondary font-medium mb-2",children:"Section:"}),e.jsxs("select",{value:n,onChange:t=>O(t.target.value),className:"w-full px-4 py-2 border border-border-theme rounded-md bg-background text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:[e.jsx("option",{value:"",children:"Select Section"}),["A","B","C","D","E","F"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-secondary font-medium mb-2",children:"Semester:"}),e.jsxs("select",{value:j,onChange:t=>T(t.target.value),className:"w-full px-4 py-2 border border-border-theme rounded-md bg-background text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:[e.jsx("option",{value:"sem1",children:"Semester 1"}),e.jsx("option",{value:"sem2",children:"Semester 2"})]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by Roll No or Name",value:R,onChange:G,className:"w-full px-3 py-2 border border-border-theme rounded-md text-sm bg-background text-primary placeholder:text-secondary focus:outline-none focus:ring-2 focus:ring-accent"})}),U?e.jsx("p",{className:"text-center text-accent font-medium",children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full border-collapse border border-border-theme text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-surface",children:[e.jsx("th",{className:"px-2 py-2 border border-border-theme text-left",children:e.jsx("input",{type:"checkbox",onChange:t=>S(t.target.checked?y.map(s=>s.studentId):[]),checked:u.length===y.length})}),e.jsx("th",{className:"px-2 py-2 border border-border-theme text-left text-primary",children:"Roll No"}),e.jsx("th",{className:"px-2 py-2 border border-border-theme text-left text-primary",children:"Student Name"}),e.jsx("th",{className:"px-2 py-2 border border-border-theme text-left text-primary",children:"Coordinator"}),e.jsx("th",{className:"px-2 py-2 border border-border-theme text-left text-primary",children:"Status"})]})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-2 py-2 text-center text-secondary",children:"No data available"})}):y.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-all",children:[e.jsx("td",{className:"px-2 py-2 border border-gray-300",children:e.jsx("input",{type:"checkbox",checked:u.includes(t.studentId),onChange:()=>z(t.studentId)})}),e.jsx("td",{className:"px-2 py-2 border border-gray-300",children:t.rollNo}),e.jsx("td",{className:"px-2 py-2 border border-gray-300",children:t.studentName}),e.jsx("td",{className:"px-2 py-2 border border-gray-300",children:t.coordinatorName}),e.jsxs("td",{className:"px-2 py-2 border border-gray-300",children:[e.jsx("button",{onClick:()=>handleApprove(t.id),className:"bg-secondary text-white px-3 py-1 rounded-md text-sm",children:"Approve"}),e.jsx("button",{onClick:()=>handleReject(t.id),className:"bg-accent text-white px-3 py-1 rounded-md text-sm",children:"Reject"})]})]},s))})]})}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsx("button",{className:"bg-secondary text-white px-3 py-1 rounded-md text-sm",onClick:()=>A("Accepted"),disabled:u.length===0,children:"Accept Selected"}),e.jsx("button",{className:"bg-accent text-white px-3 py-1 rounded-md text-sm",onClick:()=>A("Rejected"),disabled:u.length===0,children:"Reject Selected"})]})]})]})};export{te as default};
//# sourceMappingURL=CoordinatorApproval-B5z3lahh.js.map
