import{j as e}from"./query-_HUGc1jU.js";import{r}from"./router-CGnu6c2M.js";import{e as $,q as L,j as q,v as F,b as B,d as I,h as Q,u as H}from"./firebase-Cf9C3kP7.js";import{u as J,d as p}from"./index-BlT7jYU2.js";import"./vendor-Dazix4UH.js";import"./ui-BFo-ETor.js";const te=()=>{const{user:Y}=J(),[a,P]=r.useState(""),[n,O]=r.useState(""),[j,T]=r.useState("sem1"),[k,g]=r.useState([]),[U,b]=r.useState(!1),[u,S]=r.useState([]),[R,V]=r.useState(""),c=Y?.uid;r.useEffect(()=>{c?console.log("Logged in Faculty ID:",c):console.error("No logged-in Faculty ID found!")},[c]);const D=r.useCallback(async()=>{if(!a||!n||!c){console.error("Year, Section, and Faculty ID are required.");return}b(!0);try{const t=$(p,`noDues/${a}/${n}`),s=L(t,q("generatedAt","desc"),F(1)),o=await B(s);if(o.empty){console.error("No data found for the specified year and section."),g([]),b(!1);return}const x=o.docs[0].data();if(!x.students||x.students.length===0){console.log("No students found in this section."),g([]),b(!1);return}const N=(await Promise.all(x.students.map(async d=>{if(d.coordinators){const l=d.coordinators.find(h=>h.id===c);if(l){const h=I(p,"faculty","CSE_DS","members",l.id),i=await Q(h),v=I(p,`students/${a}/${n}`,d.id),f=await Q(v);if(i.exists()&&f.exists()){const w=i.data(),E=f.data();return{rollNo:E.rollNo||"N/A",studentName:E.name||"N/A",coordinatorName:w.name||"Unknown",status:l.status||"Pending",studentId:d.id,coordinatorIndex:d.coordinators.indexOf(l)}}}}return null}))).filter(Boolean).sort((d,l)=>d.rollNo.localeCompare(l.rollNo));g(N)}catch(t){console.error("Error fetching data:",t),g([])}finally{b(!1)}},[a,n,c]),_=async(t,s,o)=>{try{const m=$(p,`noDues/${a}/${n}`),x=L(m,q("generatedAt","desc"),F(1)),C=await B(x);if(!C.empty){const N=C.docs[0],d=I(p,`noDues/${a}/${n}`,N.id),h=N.data().students.map(i=>{if(i.id===t){const v=i.coordinators.map((f,w)=>w===s?{...f,status:o}:f);return{...i,coordinators:v}}return i});await H(d,{students:h}),console.log("Status updated successfully!"),D()}}catch(m){console.error("Error updating status:",m)}},z=t=>{S(s=>s.includes(t)?s.filter(o=>o!==t):[...s,t])},A=async t=>{if(u.length>0){for(const s of u){const o=k.find(m=>m.studentId===s);o&&await _(o.studentId,o.coordinatorIndex,t)}S([])}},G=t=>{V(t.target.value)},y=k.filter(t=>{const s=R.toLowerCase();return t.rollNo.toLowerCase().includes(s)||t.studentName.toLowerCase().includes(s)});return r.useEffect(()=>{a&&n&&j&&c&&D()},[a,n,j,c,D]),e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6 flex flex-col items-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Coordinator Dashboard"}),e.jsxs("div",{className:"w-full max-w-4xl bg-white border rounded-md p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Year:"}),e.jsxs("select",{value:a,onChange:t=>P(t.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Year"}),["I","II","III","IV"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Section:"}),e.jsxs("select",{value:n,onChange:t=>O(t.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Section"}),["A","B","C","D","E","F"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Semester:"}),e.jsxs("select",{value:j,onChange:t=>T(t.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"sem1",children:"Semester 1"}),e.jsx("option",{value:"sem2",children:"Semester 2"})]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by Roll No or Name",value:R,onChange:G,className:"w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})}),U?e.jsx("p",{className:"text-center text-blue-600 font-medium",children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full border-collapse border border-gray-300 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-2 py-2 border border-gray-300 text-left",children:e.jsx("input",{type:"checkbox",onChange:t=>S(t.target.checked?y.map(s=>s.studentId):[]),checked:u.length===y.length})}),e.jsx("th",{className:"px-2 py-2 border border-gray-300 text-left",children:"Roll No"}),e.jsx("th",{className:"px-2 py-2 border border-gray-300 text-left",children:"Student Name"}),e.jsx("th",{className:"px-2 py-2 border border-gray-300 text-left",children:"Coordinator"}),e.jsx("th",{className:"px-2 py-2 border border-gray-300 text-left",children:"Status"})]})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-2 py-2 text-center text-gray-500",children:"No data available"})}):y.map((t,s)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-all",children:[e.jsx("td",{className:"px-2 py-2 border border-gray-300",children:e.jsx("input",{type:"checkbox",checked:u.includes(t.studentId),onChange:()=>z(t.studentId)})}),e.jsx("td",{className:"px-2 py-2 border border-gray-300",children:t.rollNo}),e.jsx("td",{className:"px-2 py-2 border border-gray-300",children:t.studentName}),e.jsx("td",{className:"px-2 py-2 border border-gray-300",children:t.coordinatorName}),e.jsx("td",{className:"px-2 py-2 border border-gray-300",children:t.status})]},s))})]})}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsx("button",{className:"bg-green-600 text-white px-3 py-1 rounded-md text-sm",onClick:()=>A("Accepted"),disabled:u.length===0,children:"Accept Selected"}),e.jsx("button",{className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",onClick:()=>A("Rejected"),disabled:u.length===0,children:"Reject Selected"})]})]})]})};export{te as default};
//# sourceMappingURL=CoordinatorApproval-ZoaXcbwT.js.map
