import{j as e}from"./query-_HUGc1jU.js";import{r as n,u as ce}from"./router-CGnu6c2M.js";import{d as S,a as Z}from"./index-BlT7jYU2.js";import{c as de,q as k,w as F,b as L,e as ee,f as me,h as ue,d as xe,o as he}from"./firebase-Cf9C3kP7.js";import{F as c,s as ge,u as M,v as fe,d as pe,j as ye,w as be,x as Ne,r as je,y as ve,o as we}from"./ui-BFo-ETor.js";import"./vendor-Dazix4UH.js";const U="studentsCache_v2",P="studentsCacheTimestamp",Se=300*1e3,Re=()=>{const[x,_]=n.useState([]),[b,se]=n.useState(""),[C,ae]=n.useState("name"),[q,N]=n.useState(!1),[O,G]=n.useState(null),[te,re]=n.useState([]),[j,le]=n.useState(""),[I,Ce]=n.useState(""),[A,ne]=n.useState({}),[D,v]=n.useState(!1),[H,ie]=n.useState(0),Q=ce();n.useRef(Date.now());const E=n.useRef(!1),z=n.useCallback(()=>{try{const s=localStorage.getItem(U),r=localStorage.getItem(P);if(s&&r&&Date.now()-parseInt(r)<Se){const m=JSON.parse(s);if(Array.isArray(m)&&m.length>0)return m}}catch(s){console.log("Cache read failed:",s)}return null},[]),g=n.useCallback(async s=>{if(!s||E.current)return;E.current=!0;const r=Date.now();try{let a=[];try{const t=de(S,"courseDetails"),l=k(t,F("instructor","==",s.uid));a=(await L(l)).docs.map(i=>{const d=i.ref.path.split("/");return{id:i.id,year:d[1],section:d[2],semester:d[3],...i.data()}})}catch{const l=["I","II","III","IV"],o=["A","B","C","D","E","F"],i=["sem1","sem2"],d=[];for(const u of l)for(const w of o)for(const h of i){const p=ee(S,"courses",u,w,h,"courseDetails"),R=k(p,F("instructor","==",s.uid));d.push(L(R).then(y=>y.docs.map(X=>({id:X.id,year:u,section:w,semester:h,...X.data()}))).catch(()=>[]))}(await Promise.all(d)).forEach(u=>a.push(...u))}const m=new Map,J=[];a.forEach(t=>{J.push({id:t.id,name:t.courseName,year:t.year,section:t.section,semester:t.semester}),(t.students||[]).forEach(l=>{const o=typeof l=="string"?l:l?.id||l?.studentId||l;if(o){const i=`${t.year}|${t.section}`;m.has(i)||m.set(i,new Set),m.get(i).add(o)}})}),re(J);const K=[],T={};a.forEach(t=>{T[t.id]=[],(t.students||[]).forEach(l=>{const o=typeof l=="string"?l:l?.id||l?.studentId||l;o&&T[t.id].push(o)})}),ne(T);for(const[t,l]of m.entries()){const[o,i]=t.split("|"),d=Array.from(l);for(let f=0;f<d.length;f+=10){const u=d.slice(f,f+10),w=ee(S,`students/${o}/${i}`);K.push(L(k(w,F(me(),"in",u))).then(h=>h.docs.map(p=>({id:p.id,year:o,section:i,...p.data()}))).catch(async()=>{const h=u.map(R=>ue(xe(S,`students/${o}/${i}/${R}`)).then(y=>y.exists()?{id:y.id,year:o,section:i,...y.data()}:null).catch(()=>null));return(await Promise.all(h)).filter(Boolean)}))}}const oe=await Promise.all(K),V=[];oe.forEach(t=>V.push(...t));const Y=V.filter((t,l,o)=>l===o.findIndex(i=>i.id===t.id));_(Y);try{localStorage.setItem(U,JSON.stringify(Y)),localStorage.setItem(P,Date.now().toString())}catch(t){console.log("Cache write failed:",t)}const W=Date.now()-r;ie(W),console.log(`ðŸš€ Data loaded in ${W}ms`)}catch(a){console.error("Ultra-fast fetch failed:",a),G("Failed to load students. Please try again.")}finally{N(!1),v(!1)}},[]);n.useEffect(()=>{const s=z();s?(_(s),N(!1),v(!0)):N(!0)},[z]),n.useEffect(()=>{let s;return(async()=>{s=he(Z,async a=>{if(!a){G("No user is logged in."),N(!1),v(!1);return}x.length>0?g(a):await g(a)})})(),()=>{s&&s()}},[g,x.length]);const $=n.useMemo(()=>{let s=x;if(j){const r=new Set(A[j]||[]);s=s.filter(a=>r.has(a.id))}if(I.trim()){const r=new Set(A[I.trim()]||[]);s=s.filter(a=>r.has(a.id))}if(b){const r=b.toLowerCase();s=s.filter(a=>(a.name||"").toLowerCase().includes(r)||(a.email||"").toLowerCase().includes(r)||(a.rollNo||"").toLowerCase().includes(r))}return s.sort((r,a)=>C==="name"?(r.name||"").localeCompare(a.name||""):0)},[x,b,C,j,I,A]),B=n.useCallback(async()=>{v(!0),E.current=!1;try{localStorage.removeItem(U),localStorage.removeItem(P)}catch(r){console.log("Cache clear failed:",r)}const s=Z.currentUser;s&&await g(s)},[g]);return q&&x.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-12 animate-fade-in",children:[e.jsx("div",{className:"h-16 bg-gray-200 rounded-2xl mb-6 animate-pulse"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded-xl w-1/3 animate-pulse"})]}),e.jsx("div",{className:"grid gap-8 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:Array.from({length:9}).map((s,r)=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 animate-fade-in border border-gray-100",style:{animationDelay:`${r*50}ms`},children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full mr-6 animate-pulse"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4 mb-3 animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 animate-pulse"})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 animate-pulse"})]}),e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsx("div",{className:"h-8 w-20 bg-gray-200 rounded-full animate-pulse"}),e.jsx("div",{className:"h-8 w-24 bg-gray-200 rounded-full animate-pulse"})]}),e.jsx("div",{className:"h-6 w-24 bg-gray-200 rounded animate-pulse"})]},r))})]})}):O&&x.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex items-center justify-center p-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 text-center border border-gray-100",children:[e.jsx(c,{icon:ge,className:"text-blue-600 text-6xl mb-6 animate-bounce"}),e.jsx("div",{className:"text-gray-800 text-xl font-semibold mb-6",children:O}),e.jsxs("button",{onClick:B,className:"btn-campus-primary inline-flex items-center gap-3 px-8 py-4 rounded-xl shadow-lg transition-all duration-300 text-lg font-medium",children:[e.jsx(c,{icon:M}),"Try Again"]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Students"}),e.jsx("span",{className:"text-xs text-gray-500",children:H>0?`Loaded in ${H}ms`:"Loading..."}),D&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-blue-600",children:[e.jsx(c,{icon:M,className:"animate-spin"}),"Refreshing"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-semibold text-gray-900",children:$.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total Students"})]}),e.jsxs("button",{onClick:B,disabled:D,className:"btn-campus-primary inline-flex items-center gap-2 px-4 py-2 rounded-md text-sm disabled:opacity-50",children:[e.jsx(c,{icon:M,className:D?"animate-spin":""}),"Refresh"]})]})]}),e.jsx("div",{className:"compact-card mb-6",children:e.jsxs("div",{className:"grid gap-3 md:grid-cols-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(c,{icon:fe,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"}),e.jsx("input",{type:"text",placeholder:"Search students by name, email, or roll number...",value:b,onChange:s=>se(s.target.value),className:"w-full pl-10 pr-3 py-2 rounded-md border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm bg-gray-50"})]})}),e.jsx("div",{children:e.jsxs("select",{value:C,onChange:s=>ae(s.target.value),className:"w-full px-3 py-2 rounded-md border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm bg-gray-50",children:[e.jsx("option",{value:"name",children:"Sort by Name"}),e.jsx("option",{value:"rollNo",children:"Sort by Roll No"})]})}),e.jsx("div",{children:e.jsxs("select",{value:j,onChange:s=>le(s.target.value),className:"w-full px-3 py-2 rounded-md border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm bg-gray-50",children:[e.jsx("option",{value:"",children:"All Courses"}),te.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.year,"-",s.section,")"]},s.id))]})})]})}),e.jsx("section",{className:"grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:$.map((s,r)=>e.jsxs("div",{className:"group bg-white rounded-lg border p-4 hover:shadow-sm animate-fade-in cursor-pointer transition-all",style:{animationDelay:`${r*50}ms`},onClick:()=>Q(`/students/${s.year||"II"}/${s.section||"A"}/${s.id}`),children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center mr-3",children:e.jsx(c,{icon:pe,className:"text-sm"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:s.name||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-600",children:s.rollNo||"N/A"})]}),e.jsx("div",{className:"w-2.5 h-2.5 bg-green-500 rounded-full"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(c,{icon:ye,className:"text-blue-600 text-sm"}),e.jsx("span",{className:"truncate",children:s.email||"No email"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(c,{icon:be,className:"text-blue-600 text-sm"}),e.jsx("span",{children:s.rollNo||"No Roll No"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(c,{icon:Ne,className:"text-blue-600 text-sm"}),e.jsxs("span",{children:[s.year||"N/A","-",s.section||"N/A"]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("span",{className:"status-active inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",children:[e.jsx(c,{icon:je,className:"mr-1"}),"Active"]}),e.jsxs("span",{className:"status-completed inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",children:[s.year||"N/A","-",s.section||"N/A"]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:a=>{a.stopPropagation(),Q(`/students/${s.year||"II"}/${s.section||"A"}/${s.id}`)},className:"inline-flex items-center gap-1.5 text-blue-600 hover:text-blue-700 font-medium transition-all text-sm",children:["View Details",e.jsx(c,{icon:ve,className:"transition-transform group-hover:translate-x-1"})]})})]},s.id))}),$.length===0&&!q&&e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-12 border border-gray-100",children:[e.jsx(c,{icon:we,className:"text-gray-400 text-6xl mb-6"}),e.jsx("h3",{className:"text-2xl font-semibold text-gray-700 mb-3",children:"No students found"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Try adjusting your search or filter criteria."})]})})]})})};export{Re as default};
//# sourceMappingURL=StudentList-0dB5B8zx.js.map
