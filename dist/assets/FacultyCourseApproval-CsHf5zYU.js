import{j as e}from"./query-_HUGc1jU.js";import{r as o}from"./router-CGnu6c2M.js";import{h as g,j as p,u as J}from"./firebase-BUGgE2xq.js";import{u as K,d as b}from"./index-DokKvUxf.js";import"./vendor-Dazix4UH.js";import"./ui-CbbphKl4.js";const Z=()=>{const{user:x}=K(),[i,R]=o.useState(null),[n,L]=o.useState(""),[c,E]=o.useState(""),[r,Y]=o.useState(""),[P,f]=o.useState([]),[_,I]=o.useState(!1),[N,C]=o.useState([]),[j,T]=o.useState("All"),[y,V]=o.useState(""),B=[{label:"I",value:"I"},{label:"II",value:"II"},{label:"III",value:"III"},{label:"IV",value:"IV"}],$=["A","B","C","D","E","F"],q=[{label:"Semester 1",value:"sem1"},{label:"Semester 2",value:"sem2"}];o.useEffect(()=>{x?(R(x.uid),console.log("Logged in Faculty ID:",x.uid)):console.error("No user logged in!")},[x]);const v=o.useCallback(async()=>{if(!n||!c||!r||!i){console.log("Year, section, semester, or facultyLoginId is missing.");return}I(!0);try{const s=g(b,"noDues",n,c,r),l=await p(s);if(!l.exists()){console.log("NoDues document not found for the given year, section, and semester."),f([]);return}const a=l.data();if(console.log("Fetched noDues data:",a),!a.students||a.students.length===0){console.log("No students found for this section."),f([]);return}const h=(await Promise.all(a.students.map(async u=>{const t=u.courses_faculty?.find(D=>D.facultyId===i);if(!t)return null;let m="N/A";if(t.courseId){console.log("Fetching course with courseId:",t.courseId);const D=g(b,"courses",n,c,r,"courseDetails",t.courseId),k=await p(D);k.exists()?(m=k.data()?.courseName||"N/A",console.log("Course fetched:",m)):(console.error("Course not found for ID:",t.courseId),console.log("Courses Collection Path:","courses",n,c,r,"courseDetails",t.courseId))}const d=g(b,"students",n,c,u.id),A=await p(d),F=A.exists()?A.data():{};return{rollNo:F?.rollNo||"N/A",studentName:F?.name||"N/A",courseName:m,status:t.status||"Pending",studentId:u.id,courseEntry:t}}))).filter(u=>u!==null);f(h.sort((u,t)=>u.rollNo.localeCompare(t.rollNo)))}catch(s){console.error("Error fetching data:",s),f([])}finally{I(!1)}},[n,c,r,i]),z=async(s,l)=>{if(!i){console.error("Faculty login ID is missing.");return}try{const a=g(b,"noDues",n,c,r),S=await p(a);if(!S.exists()){console.log("NoDues document not found.");return}const h=S.data();if(!h.students){console.log("No students data found.");return}const u=h.students.map(t=>{if(s.includes(t.id)){const m=t.courses_faculty.map(d=>d.facultyId===i&&d.courseId?{...d,status:l}:d);return{...t,courses_faculty:m}}return t});await J(a,{students:u}),console.log("Status updated successfully!"),v()}catch(a){console.error("Error updating status:",a)}},G=s=>{C(l=>l.includes(s)?l.filter(a=>a!==s):[...l,s])},w=s=>{N.length>0?(z(N,s),C([])):console.log("No students selected!")},H=P.filter(s=>(j==="All"||s.status===j)&&(s.rollNo.toLowerCase().includes(y.toLowerCase())||s.studentName.toLowerCase().includes(y.toLowerCase())));return o.useEffect(()=>{n&&c&&r&&i&&v()},[n,c,r,i,v]),e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4 flex flex-col items-center",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 mb-6",children:"Faculty Courses Dashboard"}),e.jsxs("div",{className:"w-full max-w-4xl bg-white shadow-md rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Year:"}),e.jsxs("select",{value:n,onChange:s=>L(s.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Year"}),B.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Section:"}),e.jsxs("select",{value:c,onChange:s=>E(s.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Section"}),$.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Semester:"}),e.jsxs("select",{value:r,onChange:s=>Y(s.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Semester"}),q.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Search:"}),e.jsx("input",{type:"text",value:y,onChange:s=>V(s.target.value),placeholder:"Search by Roll No or Name",className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Status Filter:"}),e.jsxs("select",{value:j,onChange:s=>T(s.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"Accepted",children:"Accepted"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),_?e.jsx("div",{children:"Loading..."}):e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"py-2 px-4 text-left",children:"Action"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Roll No"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Student Name"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Course Name"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Status"})]})}),e.jsx("tbody",{children:H.map((s,l)=>e.jsxs("tr",{className:`${l%2===0?"bg-gray-50":"bg-white"} hover:bg-gray-100`,children:[e.jsx("td",{className:"py-2 px-4",children:e.jsx("input",{type:"checkbox",checked:N.includes(s.studentId),onChange:()=>G(s.studentId)})}),e.jsx("td",{className:"py-2 px-4",children:s.rollNo}),e.jsx("td",{className:"py-2 px-4",children:s.studentName}),e.jsx("td",{className:"py-2 px-4",children:s.courseName}),e.jsx("td",{className:"py-2 px-4",children:s.status})]},l))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("button",{onClick:()=>w("Accepted"),className:"px-6 py-2 text-white bg-green-500 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50",children:"Accept"}),e.jsx("button",{onClick:()=>w("Rejected"),className:"ml-4 px-6 py-2 text-white bg-red-500 rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50",children:"Reject"})]})]})]})};export{Z as default};
//# sourceMappingURL=FacultyCourseApproval-CsHf5zYU.js.map
